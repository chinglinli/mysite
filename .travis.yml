matrix:
  include:
    - language: node_js
      node_js: "6"
      before_install:
        - cd frontend
      install:
        - yarn
      script:
        - yarn test
      cache:
        directories:
          - "frontend/node_modules"
    - sudo: required
      language: python
      services:
        - docker
      python: "3.5"
      before_script:
        - cd backend
      script:
        - docker --version
        - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
        - docker build --no-cache -t marco79423/mysite-backend:latest .
      after_success:
        - docker push marco79423/mysite-backend:latest
        - |
          if [ ! -z "$TRAVIS_TAG" ]; then
            docker tag marco79423/mysite-backend:latest marco79423/mysite-backend:$TRAVIS_TAG
            docker push marco79423/mysite-backend:$TRAVIS_TAG
          fi
